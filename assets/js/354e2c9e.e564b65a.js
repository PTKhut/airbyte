"use strict";(self.webpackChunkdocu=self.webpackChunkdocu||[]).push([[96322],{47417:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var a=n(87462),l=(n(67294),n(3905));const r={},o="Deploy Airbyte on Kubernetes using Helm",i={unversionedId:"deploying-airbyte/on-kubernetes-via-helm",id:"deploying-airbyte/on-kubernetes-via-helm",title:"Deploy Airbyte on Kubernetes using Helm",description:"Overview",source:"@site/../docs/deploying-airbyte/on-kubernetes-via-helm.md",sourceDirName:"deploying-airbyte",slug:"/deploying-airbyte/on-kubernetes-via-helm",permalink:"/deploying-airbyte/on-kubernetes-via-helm",draft:!1,editUrl:"https://github.com/airbytehq/airbyte/blob/master/docs/../docs/deploying-airbyte/on-kubernetes-via-helm.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Deploy Airbyte on GCP (Compute Engine)",permalink:"/deploying-airbyte/on-gcp-compute-engine"},next:{title:"On Restack",permalink:"/deploying-airbyte/on-restack"}},s={},p=[{value:"Overview",id:"overview",level:2},{value:"Quickstart",id:"quickstart",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Cluster Setup",id:"cluster-setup",level:3},{value:"Install <code>kubectl</code>",id:"install-kubectl",level:3},{value:"Configure <code>kubectl</code>",id:"configure-kubectl",level:3},{value:"Install helm",id:"install-helm",level:3},{value:"Add Helm Repository",id:"add-helm-repository",level:3},{value:"Deploy Airbyte",id:"deploy-airbyte",level:2},{value:"Default deployment",id:"default-deployment",level:3},{value:"Custom deployment",id:"custom-deployment",level:3},{value:"(Alpha) Airbyte Enterprise deployment",id:"alpha-airbyte-enterprise-deployment",level:3},{value:"Migrate from old charts to new ones",id:"migrate-from-old-charts-to-new-ones",level:2},{value:"Minio migration",id:"minio-migration",level:3},{value:"Custom logging and jobs configuration",id:"custom-logging-and-jobs-configuration",level:3},{value:"Database external secrets",id:"database-external-secrets",level:3}],u={toc:p},c="wrapper";function m(e){let{components:t,...n}=e;return(0,l.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"deploy-airbyte-on-kubernetes-using-helm"},"Deploy Airbyte on Kubernetes using Helm"),(0,l.kt)("h2",{id:"overview"},"Overview"),(0,l.kt)("p",null,"Airbyte allows scaling sync workloads horizontally using Kubernetes. The core components ","(","api server, scheduler, etc",")"," run as deployments while the scheduler launches connector-related pods on different nodes."),(0,l.kt)("h2",{id:"quickstart"},"Quickstart"),(0,l.kt)("p",null,"If you don't want to configure your own Kubernetes cluster and Airbyte instance, you can use the free, open-source project ",(0,l.kt)("a",{parentName:"p",href:"https://www.plural.sh/"},"Plural")," to bring up a Kubernetes cluster and Airbyte for you. Use ",(0,l.kt)("a",{parentName:"p",href:"/deploying-airbyte/on-plural"},"this guide")," to get started."),(0,l.kt)("p",null,"Alternatively, you can deploy Airbyte on ",(0,l.kt)("a",{parentName:"p",href:"https://www.restack.io"},"Restack")," to provision your Kubernetes cluster on AWS. Follow ",(0,l.kt)("a",{parentName:"p",href:"/deploying-airbyte/on-restack"},"this guide")," to get started."),(0,l.kt)("h2",{id:"getting-started"},"Getting Started"),(0,l.kt)("h3",{id:"cluster-setup"},"Cluster Setup"),(0,l.kt)("p",null,"For local testing we recommend following one of the following setup guides:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.docker.com/desktop/kubernetes"},"Docker Desktop ","(","Mac",")")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://minikube.sigs.k8s.io/docs/start"},"Minikube"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"NOTE: Start Minikube with at least 4gb RAM with ",(0,l.kt)("inlineCode",{parentName:"li"},"minikube start --memory=4000")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://kind.sigs.k8s.io/docs/user/quick-start/"},"Kind"))),(0,l.kt)("p",null,"For testing on GKE you can ",(0,l.kt)("a",{parentName:"p",href:"https://cloud.google.com/kubernetes-engine/docs/how-to/creating-a-zonal-cluster"},"create a cluster with the command line or the Cloud Console UI"),"."),(0,l.kt)("p",null,"For testing on EKS you can ",(0,l.kt)("a",{parentName:"p",href:"https://eksctl.io/introduction/"},"install eksctl")," and run ",(0,l.kt)("inlineCode",{parentName:"p"},"eksctl create cluster")," to create an EKS cluster/VPC/subnets/etc. This process should take 10-15 minutes."),(0,l.kt)("p",null,"For production, Airbyte should function on most clusters v1.19 and above. We have tested support on GKE and EKS. If you run into a problem starting Airbyte, please reach out on the ",(0,l.kt)("inlineCode",{parentName:"p"},"#troubleshooting")," channel on our ",(0,l.kt)("a",{parentName:"p",href:"https://slack.airbyte.io/"},"Slack")," or ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/airbytehq/airbyte/issues/new?assignees=&labels=type%2Fbug&template=bug-report.md&title="},"create an issue on GitHub"),"."),(0,l.kt)("h3",{id:"install-kubectl"},"Install ",(0,l.kt)("inlineCode",{parentName:"h3"},"kubectl")),(0,l.kt)("p",null,"If you do not already have the CLI tool ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," installed, please follow ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/tools/"},"these instructions to install"),"."),(0,l.kt)("h3",{id:"configure-kubectl"},"Configure ",(0,l.kt)("inlineCode",{parentName:"h3"},"kubectl")),(0,l.kt)("p",null,"Configure ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," to connect to your cluster by using ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl use-context my-cluster-name"),"."),(0,l.kt)("p",null,"For GKE:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Configure ",(0,l.kt)("inlineCode",{parentName:"p"},"gcloud")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"gcloud auth login"),".")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"On the Google Cloud Console, the cluster page will have a ",(0,l.kt)("inlineCode",{parentName:"p"},"Connect")," button, which will give a command to run locally that looks like"),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"gcloud container clusters get-credentials $CLUSTER_NAME --zone $ZONE_NAME --project $PROJECT_NAME"),".")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Use ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl config get-contexts")," to show the contexts available.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl config use-context $GKE_CONTEXT")," to access the cluster from ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl"),"."))),(0,l.kt)("p",null,"For EKS:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html"},"Configure your AWS CLI")," to connect to your project."),(0,l.kt)("li",{parentName:"ol"},"Install ",(0,l.kt)("a",{parentName:"li",href:"https://eksctl.io/introduction/"},"eksctl")),(0,l.kt)("li",{parentName:"ol"},"Run ",(0,l.kt)("inlineCode",{parentName:"li"},"eksctl utils write-kubeconfig --cluster=<CLUSTER NAME>")," to make the context available to ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl")),(0,l.kt)("li",{parentName:"ol"},"Use ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl config get-contexts")," to show the contexts available."),(0,l.kt)("li",{parentName:"ol"},"Run ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl config use-context <eks context>")," to access the cluster with ",(0,l.kt)("inlineCode",{parentName:"li"},"kubectl"),".")),(0,l.kt)("h3",{id:"install-helm"},"Install helm"),(0,l.kt)("p",null,"To install helm simply run:"),(0,l.kt)("p",null,"For MacOS:"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"brew install helm")),(0,l.kt)("p",null,"For Linux:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Download installer script ",(0,l.kt)("inlineCode",{parentName:"li"},"curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3")),(0,l.kt)("li",{parentName:"ol"},"Assign required premissions ",(0,l.kt)("inlineCode",{parentName:"li"},"chmod 700 get_helm.sh")),(0,l.kt)("li",{parentName:"ol"},"Run script ",(0,l.kt)("inlineCode",{parentName:"li"},"./get_helm.sh"))),(0,l.kt)("h3",{id:"add-helm-repository"},"Add Helm Repository"),(0,l.kt)("p",null,"From now charts are stored in helm-repo thus there're no need to clone the repo each time you need to deploy the chart."),(0,l.kt)("p",null,"To add remote helm repo simply run: ",(0,l.kt)("inlineCode",{parentName:"p"},"helm repo add airbyte https://airbytehq.github.io/helm-charts"),"."),(0,l.kt)("p",null,"Where ",(0,l.kt)("inlineCode",{parentName:"p"},"airbyte")," is the name of the repository that will be indexed locally."),(0,l.kt)("p",null,"After adding the repo, perform the repo indexing process by running ",(0,l.kt)("inlineCode",{parentName:"p"},"helm repo update"),"."),(0,l.kt)("p",null,"After this you can browse all charts uploaded to repository by running ",(0,l.kt)("inlineCode",{parentName:"p"},"helm search repo airbyte")),(0,l.kt)("p",null,"It'll produce the output below:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"NAME                            CHART VERSION   APP VERSION     DESCRIPTION\nairbyte-oss/airbyte             0.30.23         0.39.37-alpha   Helm chart to deploy airbyte\nairbyte-oss/airbyte-bootloader  0.30.23         0.39.37-alpha   Helm chart to deploy airbyte-bootloader\nairbyte-oss/pod-sweeper         0.30.23         0.39.37-alpha   Helm chart to deploy airbyte-pod-sweeper\nairbyte-oss/server              0.30.23         0.39.37-alpha   Helm chart to deploy airbyte-server\nairbyte-oss/temporal            0.30.23         0.39.37-alpha   Helm chart to deploy airbyte-temporal\nairbyte-oss/webapp              0.30.23         0.39.37-alpha   Helm chart to deploy airbyte-webapp\nairbyte-oss/worker              0.30.23         0.39.37-alpha   Helm chart to deploy airbyte-worker\n")),(0,l.kt)("h2",{id:"deploy-airbyte"},"Deploy Airbyte"),(0,l.kt)("h3",{id:"default-deployment"},"Default deployment"),(0,l.kt)("p",null,"If you don't intend to customise your deployment, you can deploy airbyte as is with default values."),(0,l.kt)("p",null,"In order to do so, run the command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"helm install %release_name% airbyte/airbyte\n")),(0,l.kt)("h3",{id:"custom-deployment"},"Custom deployment"),(0,l.kt)("p",null,"In order to customize your deployment, you need to create ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," file in the local folder and populate it with default configuration override values."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," example can be located in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/airbytehq/airbyte-platform/blob/main/charts/airbyte/values.yaml"},"charts/airbyte")," folder of the Airbyte repository."),(0,l.kt)("p",null,"After specifying your own configuration, run the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"helm install --values path/to/values.yaml %release_name% airbyte/airbyte\n")),(0,l.kt)("h3",{id:"alpha-airbyte-enterprise-deployment"},"(Alpha) Airbyte Enterprise deployment"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"/airbyte-enterprise"},"Airbyte Enterprise")," is in early alpha stages, so this section will likely evolve. That said, if you have an Airbyte Enterprise license key and wish to install Airbyte Enterprise via helm, follow these steps:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Checkout the latest revision of the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/airbytehq/airbyte-platform"},"airbyte-platform repository"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Add your Airbyte Enterprise license key and ",(0,l.kt)("a",{parentName:"p",href:"/airbyte-enterprise#single-sign-on-sso"},"auth configuration details")," to a file called ",(0,l.kt)("inlineCode",{parentName:"p"},"airbyte.yml")," in the root directory of ",(0,l.kt)("inlineCode",{parentName:"p"},"airbyte-platform"),". You can copy ",(0,l.kt)("inlineCode",{parentName:"p"},"airbyte.sample.yml")," to use as a template:"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"cp airbyte.sample.yml airbyte.yml\n")),(0,l.kt)("p",null,"Then, open up ",(0,l.kt)("inlineCode",{parentName:"p"},"airbyte.yml")," in your text editor to fill in the indicated fields."),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"For now, auth configurations aren't easy to modify once initially installed, so please double check them to make sure they're accurate before proceeding! This will be improved in the near future.")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Make sure your helm repository is up to date:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"helm repo update\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"Install Airbyte Enterprise on helm using the following command:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"./tools/bin/install_airbyte_pro_on_helm.sh\n")),(0,l.kt)("p",null,"The default release name is ",(0,l.kt)("inlineCode",{parentName:"p"},"airbyte-pro"),". You can change this via the ",(0,l.kt)("inlineCode",{parentName:"p"},"RELEASE_NAME")," environment\nvariable."),(0,l.kt)("h2",{id:"migrate-from-old-charts-to-new-ones"},"Migrate from old charts to new ones"),(0,l.kt)("p",null,"Starting from ",(0,l.kt)("inlineCode",{parentName:"p"},"0.39.37-alpha")," we've revisited helm charts structure and separated all components of airbyte into their own independent charts, thus by allowing our developers to test single component without deploying airbyte as a whole and by upgrading single component at a time."),(0,l.kt)("p",null,"In most cases upgrade from older monolith chart to a new one should go without any issue, but if you've configured custom logging or specified custom configuration of DB or Logging then follow the instructions listed bellow"),(0,l.kt)("h3",{id:"minio-migration"},"Minio migration"),(0,l.kt)("p",null,"Since the latest release of bitnami/minio chart, they've changed the way of setting up the credentials for accessing the minio. (written mid-2022)"),(0,l.kt)("p",null,"Going forward in new version you need to specify the following values in values yaml for user/password instead old one"),(0,l.kt)("p",null,"Before:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"minio:\n  rootUser: airbyte-user\n  rootPassword: airbyte-password-123\n")),(0,l.kt)("p",null,"After:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"minio:\n  auth:\n    rootUser: minio\n    rootPassword: minio123\n\n")),(0,l.kt)("p",null,"Before upgrading the chart update values.yaml as stated above and then run:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Get the old rootPassword by running ",(0,l.kt)("inlineCode",{parentName:"li"},'export ROOT_PASSWORD=$(kubectl get secret --namespace "default" %release_name%-minio -o jsonpath="{.data.root-password}" | base64 -d)')),(0,l.kt)("li",{parentName:"ul"},"Perform upgrade of chart by running ",(0,l.kt)("inlineCode",{parentName:"li"},"helm upgrade %release_name% airbyte/airbyte --set auth.rootPassword=$ROOT_PASSWORD"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"If you get an error about setting the auth.rootPassword, then you forgot to update the ",(0,l.kt)("inlineCode",{parentName:"li"},"values.yaml")," file")))),(0,l.kt)("h3",{id:"custom-logging-and-jobs-configuration"},"Custom logging and jobs configuration"),(0,l.kt)("p",null,"Starting from ",(0,l.kt)("inlineCode",{parentName:"p"},"0.39.37-alpha")," if you've configured logging yourself using ",(0,l.kt)("inlineCode",{parentName:"p"},"logging or jobs")," section of ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," file, you need to update your configuration so you can continue to use your custom logging and jobs configuration."),(0,l.kt)("p",null,"Simply declare global value in ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," file and move everything related to logging and jobs under that section like in the example bellow:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"global:\n    logging:\n        %your_logging_options_here%\n    jobs:\n        %your_jobs_options_here%\n")),(0,l.kt)("p",null,"After updating ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," simply upgrade your chart by running command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"helm upgrade -f path/to/values.yaml %release_name% airbyte/airbyte\n")),(0,l.kt)("h3",{id:"database-external-secrets"},"Database external secrets"),(0,l.kt)("p",null,"If you're using external DB secrets, then provide them in ",(0,l.kt)("inlineCode",{parentName:"p"},"values.yaml")," under global.database section in the following format:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'  database:\n    secretName: "myOctaviaSecret"\n    secretValue: "postgresql-password"\n    host: "example.com"\n    port: "5432"\n')),(0,l.kt)("p",null,"And upgrade the chart by running:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"helm upgrade -f path/to/values.yaml %release_name% airbyte/airbyte\n")))}m.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),d=l,h=c["".concat(s,".").concat(d)]||c[d]||m[d]||r;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:l,o[1]=i;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);